
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../wave1/">
      
      
        <link rel="next" href="../pdcn/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Vague 3 Mobilité II - Documentation pré-processing Panel Lémanique</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#vague-3-mobilite-ii" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href=".." title="Documentation pré-processing Panel Lémanique" class="md-header__button md-logo" aria-label="Documentation pré-processing Panel Lémanique" data-md-component="logo">
      
  <img src="../images/Logo-Panel.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation pré-processing Panel Lémanique
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Vague 3 Mobilité II
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Documentation pré-processing Panel Lémanique" class="md-nav__button md-logo" aria-label="Documentation pré-processing Panel Lémanique" data-md-component="logo">
      
  <img src="../images/Logo-Panel.png" alt="logo">

    </a>
    Documentation pré-processing Panel Lémanique
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Accueil
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../wave1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vague 1 Mobilité I
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Vague 3 Mobilité II
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Vague 3 Mobilité II
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fonctions-get_section" class="md-nav__link">
    <span class="md-ellipsis">
      Fonctions get_section
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-clean_embedded_adjectives" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction clean_embedded_adjectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-write_files_questions" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction write_files_questions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-write_files_embeddeddata" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction write_files_embeddeddata
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-write_file_section" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction write_file_section
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction documentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-write_label_file" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction write_label_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-write_files_survey_completion" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction write_files_survey_completion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-write_files_participants" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction write_files_participants
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-main" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction main
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pdcn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vague acceptabilité sociale de mesures d'aménagement du territoire
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../rythme/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vague rythmes et temporalités de mobilité
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ete/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vague loisirs été
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../hiver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vague loisirs hiver
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contact/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contact
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fonctions-get_section" class="md-nav__link">
    <span class="md-ellipsis">
      Fonctions get_section
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-clean_embedded_adjectives" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction clean_embedded_adjectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-write_files_questions" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction write_files_questions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-write_files_embeddeddata" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction write_files_embeddeddata
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-write_file_section" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction write_file_section
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction documentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-write_label_file" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction write_label_file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-write_files_survey_completion" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction write_files_survey_completion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-write_files_participants" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction write_files_participants
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fonction-main" class="md-nav__link">
    <span class="md-ellipsis">
      Fonction main
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="vague-3-mobilite-ii">Vague 3: Mobilité II</h1>
<p>Cette page documente le preprocessing de la troisième vague fait dans le fichier <code>preprocessing-wave3.R</code>.</p>
<h2 id="fonctions-get_section">Fonctions <code>get_section</code></h2>
<p>Les deux fonctions <code>get_section_W1</code> et <code>get_section_W3</code> fonctionnent comment la fonction <a href="../wave1/#fonction-get_section"><code>get_section</code></a> de la vague 1 et permettent de récupérer les sections du questionnaire dans laquelle se trouve la question donnant en argument.</p>
<h2 id="fonction-clean_embedded_adjectives">Fonction <code>clean_embedded_adjectives</code></h2>
<ul>
<li>Description: le but de cette fonction est de donner aux questions 97 à 100 un format comme à la W1, donc trois colonnes pour chaque question, une par adjectif sélectionné. Les adjectifs sont ensuite labelled de 1 à 26. Dans la structure de FORS, les adjectifs étaient contenus dans des colonnes nommées <em>EmbeddedDataCF_36</em> à <em>EmbeddedDataCF_61</em>. Les adjectifs n'étaient en prime pas dans le même ordre pour chaque participant. Il s'agissait donc de construire un dictionnaire des adjectifs et de reconstruire ensuite le choix des particpant·es dynamiquement, selon l'ordre des adjectifs dans leur ligne.</li>
<li>Input: les données brutes de la vague 3</li>
<li>Output: les données de la vague 3 avec les questions 97 à 100 recodées</li>
<li>Détail:</li>
</ul>
<pre><code class="language-r">questions &lt;- paste0(&quot;Q&quot;, 97:100)
  embedded_cols &lt;- paste0(&quot;EmbeddedData&quot;, 36:61, &quot;_CF&quot;)

  # Extracts dynamically all the adjectives present
  adjectives &lt;- data[embedded_cols] |&gt;
    unlist(use.names = FALSE) |&gt;
    as.character() |&gt;
    trimws() |&gt;
    unique()

  adjective_list &lt;- adjectives[!is.na(adjectives) &amp; adjectives != &quot;&quot;]
</code></pre>
<p>Extrait la liste des adjectifs</p>
<pre><code class="language-r">  for (q in questions){
    response_cols &lt;- paste0(q, &quot;_&quot;, c(1:13, 21:33))

    temp &lt;- purrr::pmap_dfr(
      tibble::tibble(
        responses = split(data[response_cols], seq_len(nrow(data))),
        adjectives = split(data[embedded_cols], seq_len(nrow(data)))
      ),
      function(responses, adjectives){
        responses &lt;- as.numeric(responses)
        adjectives &lt;- as.character(adjectives)

        selected_positions &lt;- which(responses == 1)
        selected_adjectives &lt;- adjectives[selected_positions]
        standardized &lt;- match(selected_adjectives, adjective_list)

        tibble::tibble(
          !!paste0(q, &quot;_adj1&quot;) := standardized[1],
          !!paste0(q, &quot;_adj2&quot;) := standardized[2],
          !!paste0(q, &quot;_adj3&quot;) := standardized[3]
        )
      }
    )
</code></pre>
<p>Vérifie quels adjectifs ont été sélectionnés par chaque participant·e et les répartit en trois colonnes</p>
<pre><code class="language-r">temp &lt;- temp |&gt;
      dplyr::mutate(
        dplyr::across(
          everything(),
          ~ haven::labelled(.x, labels)
        )
      )

    results[[q]] &lt;- temp
  }
  final_result &lt;- dplyr::bind_cols(results)
</code></pre>
<p>Les labels sont ajoutés aux adjectifs</p>
<pre><code class="language-r">questions_labels &lt;- c(
    &quot;97&quot; = &quot;Pouvez-vous citer trois adjectifs qui vous paraissent les plus adaptés pour qualifier la voiture ? - Adjectif &quot;,
    &quot;98&quot; = &quot;Pouvez-vous citer trois adjectifs qui vous paraissent les plus adaptés pour qualifier le train (y compris Léman Express) ? - Adjectif &quot;,
    &quot;99&quot; = &quot;Pouvez-vous citer trois adjectifs qui vous paraissent les plus adaptés pour qualifier les autres transports publics (métro, tram, bus) ? - Adjectif &quot;,
    &quot;100&quot; = &quot;Pouvez-vous citer trois adjectifs qui vous paraissent les plus adaptés pour qualifier le vélo (conventionnel ou électrique) ? - Adjectif &quot;
  )
</code></pre>
<p>Les labels des questions sont crées</p>
<pre><code class="language-r">texte_map &lt;- list(
    &quot;Q97_TEXTE&quot; = &quot;Autre_TEXTE_voiture&quot;,
    &quot;Q98_TEXTE&quot; = &quot;Autre_TEXTE_train&quot;,
    &quot;Q99_TEXTE&quot; = &quot;Autre_TEXTE_autresTPs&quot;,
    &quot;Q100_TEXTE&quot; = &quot;Autre_TEXTE_velo&quot;
  )

  for (q_num in 97:100) {
    q &lt;- paste0(&quot;Q&quot;, q_num)
    new_colname &lt;- paste0(q, &quot;_TEXTE&quot;)
    source_col &lt;- texte_map[[new_colname]]

    if (source_col %in% names(data)) {
      text_vector &lt;- as.character(data[[source_col]])
      text_vector[text_vector == &quot;&quot; | text_vector == &quot;-99&quot;] &lt;- NA

      text_col &lt;- haven::labelled(
        text_vector,
        label = paste0(
          gsub(&quot; - Adjectif $&quot;, &quot;&quot;, questions_labels[as.character(q_num)]),
          &quot; - Autre adjectif (texte libre)&quot;
        )
      )

      # Trouver position d'insertion après Qxx_adj3
      insertion_point &lt;- match(paste0(q, &quot;_adj3&quot;), names(final_result)) + 1

      if (insertion_point &gt; ncol(final_result)) {
        final_result &lt;- dplyr::bind_cols(
          final_result,
          tibble::tibble(!!new_colname := text_col)
        )
      } else {
        final_result &lt;- dplyr::bind_cols(
          final_result[ , 1:(insertion_point - 1)],
          tibble::tibble(!!new_colname := text_col),
          final_result[ , insertion_point:ncol(final_result)]
        )
      }
    } else {
      warning(&quot;Colonne manquante dans les données : &quot;, source_col)
    }
  }
</code></pre>
<p>Les participant·es avaient également la possibilité de rajouter des adjectifs en cliquant sur "Autre". Ces réponses sous forme de texte sont récupérées, labeled et ajoutées dans le tibble au bon endroit.</p>
<pre><code class="language-r">to_remove_q &lt;- unlist(lapply(97:100, function(q) paste0(&quot;Q&quot;, q, &quot;_&quot;, c(1:13, 21:33))))
  to_remove_embedded &lt;- paste0(&quot;EmbeddedData&quot;, 36:61, &quot;_CF&quot;)

  adjectif_suffixes &lt;- c(&quot;voiture&quot;, &quot;train&quot;, &quot;autresTPs&quot;, &quot;velo&quot;)
  pattern &lt;- paste0(&quot;^[^Q].*_(&quot;, paste(adjectif_suffixes, collapse = &quot;|&quot;), &quot;)$&quot;)
  to_remove_adjectif &lt;- grep(pattern, names(data), value = TRUE)

  to_remove &lt;- c(to_remove_q, to_remove_embedded, to_remove_adjectif)

  insert_pos &lt;- min(which(names(data) %in% to_remove_q))

  data_cleaned &lt;- data[ , !(names(data) %in% to_remove)]
  before &lt;- data_cleaned[ , 1:(insert_pos - 1), drop = FALSE]
  after  &lt;- data_cleaned[ , insert_pos:ncol(data_cleaned), drop = FALSE]

  data_final &lt;- dplyr::bind_cols(before, final_result, after)
</code></pre>
<p>Les colonnes obsolétes sont supprimées et les colonnes nouvellement crées insérées à leur place.</p>
<pre><code class="language-r">for (q in 97:100) {
    for (adj_num in 1:3) {
      colname &lt;- paste0(&quot;Q&quot;, q, &quot;_adj&quot;, adj_num)
      if (colname %in% names(data_final)) {
        attr(data_final[[colname]], &quot;label&quot;) &lt;- paste0(
          questions_labels[as.character(q)],
          adj_num
        )
      }
    }
  }
</code></pre>
<p>Les colonnes sont labellisées.</p>
<h2 id="fonction-write_files_questions">Fonction <code>write_files_questions</code></h2>
<p>Reprend la structure de la même fonction dans la <a href="../wave1/#fonction-write_files_questions">vague 1</a>. Néanmoins, certaines questions de la vague 1 étaient reprises sous la forme <code>W1_q*</code>. La section de ces questions dans le questionnaire de la vague 1 est obtenue avec la fonction [<code>get_section_W1][wave3.md#fonction-get_section], tandis que pour les questions de la vague 3, la section est obtenue avec</code>get_section_W3`.</p>
<p>Comme certaines questions sont les mêmes entre les vagues 1 et 3, une nouvelle colonne a été créée, indiquant si une question de la vague 3 reprenait une question de la vague 1. Cette colonne est créée avec:</p>
<pre><code class="language-r">if (length(matches) &gt; 0) {
          original_match &lt;- names(data)[tolower(names(data)) == matches[1]]
          lien_avec_W1 &lt;- c(lien_avec_W1, original_match)
        } else {
          lien_avec_W1 &lt;- c(lien_avec_W1, NA_character_)
        }
      } else {
        # Si ce n’est pas une Q de W3, alors pas de lien
        lien_avec_W1 &lt;- c(lien_avec_W1, NA_character_)
      }
</code></pre>
<p>Pour certaines questions, la section ainsi que le lien avec la question de la W1 a été attribué manuellement:</p>
<pre><code class="language-r">num &lt;- suppressWarnings(as.integer(stringr::str_extract(i, &quot;(?i)(?&lt;=q)\\d+&quot;)))

      if (stringr::str_detect(i, &quot;Q320|Q285|Q291&quot;)) {
        section_name &lt;- c(section_name, &quot;W3- Travail/Formation&quot;)
      } else if (stringr::str_detect(i, &quot;Q218&quot;)) {
        section_name &lt;- c(section_name, &quot;W3- Activités&quot;)
      } else if (stringr::str_detect(i, &quot;^Q303(_\\d+)?$&quot;)) {
        section_name &lt;- c(section_name, &quot;W3- Séjours&quot;)
      } else if (stringr::str_detect(i, &quot;Q129_R&quot;)) {
        section_name &lt;- c(section_name, &quot;W3- Satisfaction&quot;)
      } else if (stringr::str_detect(i, &quot;W1&quot;)) {
        section_name &lt;- c(section_name, get_section_W1(num))
      } else {
        section_name &lt;- c(section_name, get_section_W3(num))
      }

      if (stringr::str_detect(i, &quot;^Q325(_\\d+)?$&quot;)) {
        lien_avec_W1 &lt;- c(lien_avec_W1, &quot;W1_q117&quot;)
      } else if (stringr::str_detect(i, &quot;^Q326(_\\d+)?$&quot;)) {
        lien_avec_W1 &lt;- c(lien_avec_W1, &quot;W1_q118&quot;)
      } else if (stringr::str_detect(i, &quot;^Q327(_\\d+)?$&quot;)) {
        lien_avec_W1 &lt;- c(lien_avec_W1, &quot;W1_q119&quot;)
      } else if (stringr::str_detect(i, &quot;^Q\\d+&quot;)) {
        prefix &lt;- paste0(&quot;w1_q&quot;, num)  # lower
        pattern &lt;- paste0(&quot;^&quot;, prefix, &quot;(_|$)&quot;)
</code></pre>
<h2 id="fonction-write_files_embeddeddata">Fonction <code>write_files_embeddeddata</code></h2>
<p>Les adjectifs des questions 97 à 100 n'étaient pas les seules informations stockées dans des <em>EmbeddedData</em>. Cette fonction liste donc les autres <em>EmbeddedData</em> ainsi que leur label.</p>
<h2 id="fonction-write_file_section">Fonction <code>write_file_section</code></h2>
<p>Similaire à la <a href="../wave1/#fonction-write_file_section">vague 1</a>.</p>
<h2 id="fonction-documentation">Fonction <code>documentation</code></h2>
<p>Similaire à la <a href="../wave1/#fonction-documentation">vague 1</a></p>
<h2 id="fonction-write_label_file">Fonction <code>write_label_file</code></h2>
<p>Similaire à la <a href="../wave1/#fonction-write_label_file">vague 1</a></p>
<h2 id="fonction-write_files_survey_completion">Fonction <code>write_files_survey_completion</code></h2>
<p>Similaire à la <a href="../wave1/#fonction-write_files_survey_completion">vague 1</a></p>
<h2 id="fonction-write_files_participants">Fonction <code>write_files_participants</code></h2>
<p>Similaire à la <a href="../wave1/#fonction-write_files_participants">vague 1</a>. Néanmois, certaines variables ont été rajoutées:</p>
<ul>
<li>
<p>Les variables <em>FlagAvantLancement</em> et <em>FlagPrblmStatut</em></p>
</li>
<li>
<p>Les variables <em>Titre_source</em> et <em>Titre_actuel</em>, représentant le titre avec lequel les participant·es aimeraient être adressé·es (M, Mme, ...)</p>
</li>
<li>
<p>Les variables <em>code_raison_contact</em>, indiquant la raison pour une potentielle prise de contact avec FORS.</p>
</li>
</ul>
<h2 id="fonction-main">Fonction <code>main</code></h2>
<p>Principalement similaire à la <a href="../wave1/#fonction-main">vague 1</a>. Les spécificités sont listées ci-dessous:</p>
<pre><code class="language-r">geodata &lt;- &quot;geolocalised_data.csv&quot;
raw_q129 &lt;- &quot;EPFL-PanelLémanique-Vague3-mobilité_Q129 anonymisée_EPFL-NOPASSWORD.sav&quot;
</code></pre>
<p>Certaines géodonnées dans les données brutes de FORS étaient sous forme d'adresses, d'autres en tant que coordonnées. Les géodonnées sous forme d'adresses ont donc été géocodées dans un fichier à part et sont importées ici.</p>
<p>De plus, FORS a envoyé des données manquantes dans un fichier séparé, elles sont donc chargées ici (<code>raw_Q129</code>).</p>
<pre><code class="language-r">wave3_data &lt;- wave3_data[, -which(names(wave3_data) == &quot;W1_q112&quot;)]
attr(wave3_data$Q112_regroup, &quot;label&quot;) &lt;- &quot;Quelle profession exercez-vous actuellement?&quot;
  attr(wave3_data$Q114_regroup, &quot;label&quot;) &lt;- &quot;Quelle profession exercez-vous actuellement?&quot;
  attr(wave3_data$Q41_regroup, &quot;label&quot;) &lt;- &quot;En moyenne, combien de jours par semaine travaillez-vous ? - regroupé&quot;
</code></pre>
<p>La question <code>W1_q112</code> étant vide, elle est supprimée. Les labels des questions 112, 114 et 41 sont rajoutés manuellement</p>
<pre><code class="language-r">coords_csv &lt;- coords_csv |&gt;
    dplyr::rename(Q14 = lat_lng)

  names(coords_csv)[2:ncol(coords_csv)] &lt;- paste0(names(coords_csv)[2:ncol(coords_csv)], &quot;_geocoded&quot;)
  coords_csv$Q14_geocoded[coords_csv$Q14_geocoded == &quot;NA,NA&quot;] &lt;- NA

  # Labels the variables from coords_csv
  for (col in names(coords_csv)) {
    if (endsWith(col, &quot;_geocoded&quot;)) {
      original_col &lt;- sub(&quot;_geocoded$&quot;, &quot;&quot;, col)

      if (original_col %in% names(wave3_data)) {
        label &lt;- attr(wave3_data[[original_col]], &quot;label&quot;)
        if (!is.null(label)) {
          attr(coords_csv[[col]], &quot;label&quot;) &lt;- label
        }
      }
    }
  }

  wave3_data &lt;- dplyr::left_join(wave3_data, coords_csv, by = &quot;IDNO&quot;)
</code></pre>
<p>Les géodonnées sont labellisées et rajoutées au reste des données</p>
<pre><code class="language-r">cols_to_process &lt;- c(&quot;Q14&quot;, &quot;W1_q14&quot;, &quot;Q14_regroup&quot;, &quot;Q43&quot;, &quot;Q48&quot;, &quot;W1_q48&quot;, &quot;Q48_regroup&quot;, &quot;Q50&quot;, &quot;W1_q50&quot;, &quot;Q50_regroup&quot;, &quot;Q51&quot;, &quot;W1_q51&quot;, &quot;Q51_regroup&quot;)
  for (col in cols_to_process) {
    lbl &lt;- attr(wave3_data[[col]], &quot;label&quot;)
    wave3_data[[col]] &lt;- sapply(wave3_data[[col]], extract_lat_lng)
    attr(wave3_data[[col]], &quot;label&quot;) &lt;- lbl
  }
</code></pre>
<p>Elles sont ensuite reformatées à l'aide de <code>extract_lat_lng</code>.</p>
<pre><code class="language-r">cols_to_replace &lt;- setdiff(names(Q129), c(&quot;Q129_R&quot;, &quot;IDNO&quot;))
  for (colname in cols_to_replace) {
    Q129[[colname]][is.na(Q129[[colname]])] &lt;- 0
  }

  Q129 &lt;- dplyr::select(Q129, IDNO, Q129_R, Opt_Out_de_tout_le_projet, FlagAutreRepQ129_R) %&gt;%
    dplyr::rename(Suppression_Q129_W3C5 = Opt_Out_de_tout_le_projet)

  wave3_data &lt;- dplyr::left_join(wave3_data, Q129, by = &quot;IDNO&quot;)
</code></pre>
<p>Les colonnes importante du fichier <code>raw_q129</code> sont rajoutées aux données de base.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>